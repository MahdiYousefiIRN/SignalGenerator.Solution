@page
@model SignalGenerator.Web.Pages.SendSignal.IndexModel
@{
    ViewData["Title"] = "Send Signal";
}

<h2>@ViewData["Title"]</h2>

<!-- فرم ارسال سیگنال‌ها -->
<div>
    <h4>Send Signals</h4>
    <form id="sendSignalsForm" method="post">
        <label for="protocolType">Protocol Type:</label>
        <select id="protocolType" name="ProtocolType" required>
            <option value="http">HTTP</option>
            <option value="modbus">Modbus</option>
            <option value="signalar">SignalR</option>
        </select>

        <label for="signalCount">Number of Signals:</label>
        <input type="number" id="signalCount" name="SignalCount" min="1" max="1000" placeholder="Enter number of signals" required value="10" />

        <label for="duration">Duration (in minutes):</label>
        <input type="number" id="duration" name="Duration" min="1" max="1440" placeholder="Duration in minutes" required value="60" />

        <button type="submit">Send Signals</button>
    </form>

    <div id="sendResult">
        @if (!string.IsNullOrEmpty(Model.SendResult))
        {
            <p class="success-msg">@Model.SendResult</p>
        }
    </div>

</div>

@section Scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#sendSignalsForm').on('submit', function (e) {
                e.preventDefault();

                $('button[type="submit"]').prop('disabled', true).text('Sending...');

                var formData = {
                    ProtocolType: $('#protocolType').val(),
                    SignalCount: parseInt($('#signalCount').val(), 10),
                    Duration: parseInt($('#duration').val(), 10)
                };

                      $.ajax({
            url: '@Url.Page("SendSignal/Index")', // مسیر صحیح صفحه
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            dataType: 'json',
            success: function (response) {
                $('#sendResult').html('<p class="text-success">' + response.sendResult + '</p>');
            },
            error: function (xhr) {
                let errorMessage = 'Error sending signals.';
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    errorMessage = xhr.responseJSON.message;
                }
                $('#sendResult').html('<p class="text-danger">' + errorMessage + '</p>');
            }
        });

            });
        });
    </script>
    <style>
        .success-msg {
            color: green;
            font-weight: bold;
        }
        .error-msg {
            color: red;
            font-weight: bold;
        }
    </style>
}
